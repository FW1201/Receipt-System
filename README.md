# 電子領據系統 - 完整版

## 📋 系統概述

這是一個基於 Google Apps Script 的電子領據管理系統，提供完整的領據發送、填寫、管理和 PDF 生成功能。

### 🎯 主要功能

- **管理員功能**：發送領據邀請、查看填寫紀錄、生成 PDF 領據
- **領款人功能**：線上填寫個人資料、銀行資訊、電子簽名
- **自動化處理**：郵件通知、檔案管理、PDF 生成
- **安全控制**：單一管理員權限、資料加密儲存

## 📁 檔案結構

```
電子領據系統/
├── Code.gs          # 後端邏輯（Google Apps Script）
├── Interface.html   # 前端介面（HTML/CSS/JavaScript）
└── README.md        # 部署說明文件
```

## 🚀 快速部署

### 步驟 1：建立 Google 試算表

1. 前往 [Google 試算表](https://sheets.google.com)
2. 建立新的試算表
3. 將試算表命名為「電子領據系統」

### 步驟 2：設定 Apps Script

1. 在試算表中點擊「擴充功能」→「Apps Script」
2. 刪除預設的 `myFunction()` 程式碼
3. 將 `Code.gs` 的完整內容貼上
4. 點擊左側「+」→「HTML」→命名為「Interface」
5. 將 `Interface.html` 的完整內容貼上
6. 儲存專案（Ctrl+S）

### 步驟 3：部署 Web App

1. 點擊「部署」→「新增部署作業」
2. 選擇類型：「網頁應用程式」
3. 設定：
   - **執行身份**：我
   - **存取權限**：任何人
4. 點擊「部署」
5. **重要**：複製 Web App URL 並加入書籤

### 步驟 4：系統初始化

1. 回到 Google 試算表
2. 重新整理頁面
3. 點擊「電子領據系統」選單 → 「🚀 首次設定」
4. 等待設定完成提示

## 🔧 系統配置

### 資料庫結構

系統會自動建立包含以下欄位的試算表：

| 欄位 | 說明 | 填寫者 |
|------|------|--------|
| 唯一ID | 系統自動生成 | 系統 |
| 狀態 | Pending/Sent/Submitted | 系統 |
| 領據抬頭 | 組織名稱 | 管理員 |
| 事件名稱 | 活動或服務名稱 | 管理員 |
| 事由 | 費用性質 | 管理員 |
| 領款人姓名 | 收款人姓名 | 管理員 |
| Email | 收款人信箱 | 管理員 |
| 身分證字號 | 預留欄位 | - |
| 金額 | 新台幣金額 | 管理員 |
| 時數 | 服務時數 | 管理員 |
| 撥款單位 | 付款組織 | 管理員 |
| 連結發送時間 | 邀請發送時間 | 系統 |
| 提交時間 | 領款人提交時間 | 系統 |
| 填寫身分證 | 領款人身分證 | 領款人 |
| 戶籍地址 | 領款人地址 | 領款人 |
| 聯絡電話 | 領款人電話 | 領款人 |
| 服務單位 | 領款人工作單位 | 領款人 |
| 銀行代號 | 銀行代碼 | 領款人 |
| 分行代號 | 分行代碼 | 領款人 |
| 帳號 | 銀行帳號 | 領款人 |
| 存摺影本 | 檔案連結 | 領款人 |
| 簽名檔案 | 電子簽名連結 | 領款人 |
| PDF領據 | 生成的PDF連結 | 系統 |

### 檔案管理

系統會自動建立以下 Google Drive 資料夾：

- **電子領據系統_[時間戳記]**（主資料夾）
  - **簽名檔案**：儲存電子簽名
  - **PDF領據**：儲存生成的領據
  - **存摺影本**：儲存上傳的存摺影本
  - **領據範本**：PDF 生成範本

## 👥 使用流程

### 管理員操作流程

1. **登入管理後台**
   - 訪問：`{Web App URL}?page=admin`
   - 系統自動驗證部署者身份

2. **發送領據邀請**
   - 填寫領據抬頭、領款人資訊
   - 設定撥款單位、事件名稱、事由
   - 輸入金額和時數
   - 點擊「發送邀請」

3. **管理填寫紀錄**
   - 查看所有邀請狀態
   - 監控提交進度
   - 生成 PDF 領據

### 領款人操作流程

1. **收到邀請郵件**
   - 包含完整領據資訊
   - 專屬填寫連結

2. **填寫個人資料**
   - 身分證字號、戶籍地址
   - 聯絡電話、服務單位
   - 銀行資訊（代號、分行、帳號）

3. **上傳文件**
   - 存摺影本（JPG/PNG，5MB以內）
   - 電子簽名（線上簽名板）

4. **提交完成**
   - 系統自動儲存所有資料
   - 狀態更新為「已提交」

## 🔒 安全特性

### 權限控制
- **單一管理員**：僅限 Apps Script 部署者登入
- **身份驗證**：使用 Google 帳號驗證
- **資料隔離**：每個連結僅對應一筆資料

### 資料保護
- **加密傳輸**：HTTPS 安全連線
- **檔案權限**：Google Drive 權限控制
- **資料備份**：Google 雲端自動備份

### 操作記錄
- **時間戳記**：記錄所有操作時間
- **狀態追蹤**：完整的流程狀態管理
- **錯誤處理**：完善的錯誤提示和處理

## 🛠️ 進階設定

### 自訂 PDF 範本

1. 在 Google Drive 中找到「領據範本」文件
2. 編輯範本內容（保留 `{{變數名稱}}` 格式）
3. 可用變數：
   - `{{receipt_header}}`：領據抬頭
   - `{{recipient_name}}`：領款人姓名
   - `{{submitted_id_number}}`：身分證字號
   - `{{submitted_address}}`：戶籍地址
   - `{{submitted_phone}}`：聯絡電話
   - `{{service_unit}}`：服務單位
   - `{{payer_unit}}`：撥款單位
   - `{{event_reason}}`：事由
   - `{{amount}}`：金額
   - `{{amount_text}}`：金額大寫
   - `{{hours}}`：時數
   - `{{bank_code}}`：銀行代號
   - `{{branch_code}}`：分行代號
   - `{{account_number}}`：帳號
   - `{{submission_date}}`：提交日期
   - `{{signature}}`：電子簽名

### 郵件範本自訂

在 `Code.gs` 中的 `createEmailTemplate` 函數可以自訂邀請郵件內容。

### 系統重置

如需重置系統：
1. 在試算表中點擊「電子領據系統」→「🔄 重置系統」
2. 重新執行「🚀 首次設定」

## 📊 系統監控

### 狀態檢查

點擊「電子領據系統」→「📊 系統狀態」查看：
- 管理員資訊
- Web App URL
- 各項配置狀態

### 常見問題排除

1. **登入失敗**
   - 確認使用部署者 Google 帳號
   - 檢查 Web App 部署設定
   - 重新執行首次設定

2. **郵件發送失敗**
   - 檢查收件人信箱格式
   - 確認 Gmail 配額未超限

3. **PDF 生成失敗**
   - 確認領款人已完成提交
   - 檢查 Drive 儲存空間

## 🔄 版本更新

如需更新系統：
1. 備份現有資料
2. 更新 `Code.gs` 和 `Interface.html`
3. 重新部署 Web App（選擇「新版本」）

## 📞 技術支援

### 系統需求
- Google 帳號
- 現代瀏覽器（Chrome、Firefox、Safari、Edge）
- 網路連線

### 相容性
- 桌面電腦：完整功能
- 平板電腦：完整功能
- 手機：基本功能（建議使用桌面版）

---

**版本**：1.0.0  
**更新日期**：2025年1月  
**開發者**：電子領據系統團隊